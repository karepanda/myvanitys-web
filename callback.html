<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>OAuth Callback</title>
   <script>
      // Function to extract the access_token from the URL
      function getAccessToken() {
         const urlParams = new URLSearchParams(window.location.search); // Use window.location.hash to get parameters if needed
         const accessToken = urlParams.get('access_token');
         const state = urlParams.get('state'); // Capture the state if necessary

         console.log('Access token', accessToken);
         console.log('state', state);

         if (accessToken) {
            // You can send the access_token to your API here
            fetch('http://localhost:8080/myvanitys/auth/google', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer 4/P7q7W91`,
                  'X-Request-Id': 'd2919d3f-6b2f-49f4-9dd5-efbbc9b1c8f8',
                  'X-Flow-Id': '123e4567-e89b-12d3-a456-426614174000',
                  'User-Agent': 'MyVanitysApp/1.0',
                  'Accept-Language': 'en-US'
               },
               body: JSON.stringify({token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.example.payload.signature'}),

            })
               .then(response => {
                  if (!response.ok) {
                     // Throw an error if the response is not successful
                     throw new Error(`HTTP error! Status: ${response.status}`);
                  }
                  // Check if there is content before parsing as JSON
                  return response.text().then(text => {
                     return text ? JSON.parse(text) : {};
                  });
               })
               .then(data => {
                  console.log('Response from API:', data);
               })
               .catch(error => {
                  console.error('Error:', error);
               });

         } else {
            console.error('No access token found in the URL.');
         }
      }

      // Execute the function when the page loads
      window.onload = getAccessToken;
   </script>
</head>

<body>
   <h1>Authenticating...</h1>
   <p>Please wait while we process your login.</p>
</body>

</html>
